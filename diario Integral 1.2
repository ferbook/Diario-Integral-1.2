<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>Diario Integral 2</title>
    <style>
      body {
        font-family: 'Segoe UI', sans-serif;
        background-color: #f7f2ec;
        color: #5a4437;
        max-width: 600px;
        margin: auto;
        padding: 2rem;
      }
      h1 {
        color: #c2a469;
      }
      select, textarea, input, button {
        width: 100%;
        margin-top: 10px;
        padding: 10px;
        border-radius: 8px;
        border: 1px solid #ccc;
        font-size: 16px;
      }
      button {
        background-color: #c2a469;
        color: white;
        border: none;
        cursor: pointer;
        font-weight: bold;
        margin-top: 15px;
      }
      .bloque {
        margin-bottom: 2rem;
        padding: 1rem;
        background-color: #eeeae4;
        border-radius: 10px;
      }
      audio {
        width: 100%;
        margin-top: 10px;
      }
      .hora-label {
        display: inline-block;
        width: 45%;
      }
      .hora-input {
        width: 48%;
        display: inline-block;
        margin-top: 10px;
      }
    </style>
  </head>
  <body>
    <h1>Diario Integral 2</h1>
    <p>Registra tus emociones y tu hora de sueño día a día.</p>

    <div class="bloque">
      <h2>¿Cómo te sientes hoy?</h2>
      <select id="estado">
        <option value="">Selecciona una emoción</option>
        <option value="ansiedad">Ansiedad</option>
        <option value="tristeza">Tristeza</option>
        <option value="estres">Estrés</option>
      </select>
      <button onclick="mostrarRecomendacion()">Obtener recomendación</button>
      <div id="recomendacion" style="margin-top: 1rem;"></div>
    </div>

    <div class="bloque">
      <h2>Escribe aquí cómo te sientes</h2>
      <textarea id="diario" placeholder="Describe tus emociones..."></textarea>
      <button onclick="enviarDiario()">Enviar</button>
      <div id="mensajeDiario" style="margin-top: 10px;"></div>
    </div>

    <div class="bloque">
      <h2>Hora de sueño</h2>
      <label class="hora-label">Hora de dormir:</label>
      <input class="hora-input" type="time" id="horaDormir" />
      <label class="hora-label">Hora de despertar:</label>
      <input class="hora-input" type="time" id="horaDespertar" />
    </div>

    <div class="bloque">
      <button onclick="guardarTodo()">Guardar día</button>
      <p id="guardarMensaje" style="margin-top: 10px;"></p>
    </div>

    <script>
      const meditaciones = {
        ansiedad: {
          texto: "La ansiedad puede ser abrumadora. Respira profundo conmigo y escucha esta meditación guiada.",
          audio: "https://actions.google.com/sounds/v1/ambiences/forest_stream.ogg",
        },
        tristeza: {
          texto: "Cuando la tristeza llega, recuerda que es pasajera. Aquí tienes una meditación para tu alma.",
          audio: "https://actions.google.com/sounds/v1/nature/rain_on_leaves.ogg",
        },
        estres: {
          texto: "El estrés puede desgastarte. Respira y relájate con esta sencilla meditación.",
          audio: "https://actions.google.com/sounds/v1/ambiences/wind_in_trees.ogg",
        },
      };

      function mostrarRecomendacion() {
        const estado = document.getElementById("estado").value;
        const div = document.getElementById("recomendacion");
        if (estado && meditaciones[estado]) {
          div.innerHTML = `
            <p>${meditaciones[estado].texto}</p>
            <audio controls src="${meditaciones[estado].audio}"></audio>
          `;
        } else {
          div.innerHTML = "<p>Por favor, selecciona una emoción.</p>";
        }
      }

      function enviarDiario() {
        const texto = document.getElementById("diario").value.trim();
        const msg = document.getElementById("mensajeDiario");
        if (texto.length === 0) {
          msg.textContent = "Escribe algo para que te pueda escuchar.";
        } else {
          msg.textContent = "Gracias por compartir. Tu mensaje ha sido registrado.";
          document.getElementById("diario").value = "";
        }
      }

      function guardarTodo() {
        const estado = document.getElementById("estado").value;
        const diario = document.getElementById("diario").value.trim();
        const dormir = document.getElementById("horaDormir").value;
        const despertar = document.getElementById("horaDespertar").value;

        if (!estado || !dormir || !despertar) {
          document.getElementById("guardarMensaje").textContent = "Completa todos los campos para guardar.";
          return;
        }

        const datos = {
          fecha: new Date().toISOString().split("T")[0],
          emocion: estado,
          entradaDiario: diario,
          horaDormir: dormir,
          horaDespertar: despertar,
        };

        let almacen = JSON.parse(localStorage.getItem("registros") || "[]");
        almacen.push(datos);
        localStorage.setItem("registros", JSON.stringify(almacen));

        document.getElementById("guardarMensaje").textContent = "Registro guardado correctamente.";
      }
    </script>
  </body><div class="bloque">
  <h2>Visualizaciones</h2>
  <button onclick="mostrarGraficas()">Ver visualizaciones</button>
  <canvas id="graficaEmociones" style="margin-top:20px;" height="200"></canvas>
  <canvas id="graficaSueno" style="margin-top:20px;" height="200"></canvas>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
  function mostrarGraficas() {
    const registros = JSON.parse(localStorage.getItem("registros") || "[]");

    if (registros.length === 0) {
      alert("Aún no hay datos registrados.");
      return;
    }

    // EMOCIONES
    const emociones = {};
    registros.forEach(r => {
      emociones[r.emocion] = (emociones[r.emocion] || 0) + 1;
    });

    const ctx1 = document.getElementById('graficaEmociones').getContext('2d');
    new Chart(ctx1, {
      type: 'bar',
      data: {
        labels: Object.keys(emociones),
        datasets: [{
          label: 'Frecuencia de emociones',
          data: Object.values(emociones),
          backgroundColor: ['#f4a261', '#2a9d8f', '#e76f51'],
        }]
      },
      options: {
        responsive: true,
        plugins: {
          legend: { display: false }
        }
      }
    });

    // SUEÑO
    const fechas = registros.map(r => r.fecha);
    const horas = registros.map(r => {
      const d1 = new Date(`1970-01-01T${r.horaDormir}`);
      const d2 = new Date(`1970-01-01T${r.horaDespertar}`);
      let diff = (d2 - d1) / (1000 * 60 * 60);
      if (diff < 0) diff += 24;
      return parseFloat(diff.toFixed(2));
    });

    const ctx2 = document.getElementById('graficaSueno').getContext('2d');
    new Chart(ctx2, {
      type: 'line',
      data: {
        labels: fechas,
        datasets: [{
          label: 'Horas de sueño',
          data: horas,
          backgroundColor: 'rgba(100,150,250,0.2)',
          borderColor: '#264653',
          borderWidth: 2,
          tension: 0.3,
        }]
      },
      options: {
        responsive: true,
        scales: {
          y: { beginAtZero: true }
        }
      }
    });
  }
</script>
</html>
